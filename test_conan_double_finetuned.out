Loading rhel7/default-gpu
  Loading requirement: dot slurm turbovnc/2.0.1 vgl/2.5.1/64 singularity/current
    rhel7/global cuda/8.0 gcc-5.4.0-gcc-4.8.5-fis24gg
    openmpi-1.10.7-gcc-5.4.0-jdc7f4f cmake/latest
2022-03-23 22:16:54,375 WARNING  | Overriding opt["fromfile_datapath"] to /rds/project/rds-Yuap0gjVpKM/jw2055/counterspeech-iib-project/counterspeech_project-NLP/generator_only/data/gab_trial.txt (previously: /rds/project/rds-Yuap0gjVpKM/jw2055/counterspeech-iib-project/counterspeech_project-NLP/generator_only/data/conan_data)
2022-03-23 22:16:54,376 WARNING  | Overriding opt["skip_generation"] to False (previously: True)
2022-03-23 22:16:54,963 INFO     | Using CUDA
2022-03-23 22:16:54,983 INFO     | loading dictionary from /rds/project/rds-Yuap0gjVpKM/jw2055/counterspeech-iib-project/counterspeech_project-NLP/generator_only/from_pretrained_generative_conan_temperature/model.dict
2022-03-23 22:16:55,009 INFO     | num words = 8008
2022-03-23 22:17:38,008 INFO     | Total parameters: 2,696,268,800 (2,695,613,440 trainable)
2022-03-23 22:17:38,009 INFO     | Loading existing model params from /rds/project/rds-Yuap0gjVpKM/jw2055/counterspeech-iib-project/counterspeech_project-NLP/generator_only/from_pretrained_generative_conan_temperature/model
2022-03-23 22:19:44,157 INFO     | creating task(s): fromfile:parlaiformat
2022-03-23 22:19:44,192 WARNING  | You are using this fromfile data as a valid or test set without setting fromfile_datatype_extension to true. Please be aware this uses directly the file you indicated, make sure this is not the same as your training file.
2022-03-23 22:19:44,192 INFO     | Loading ParlAI text data: /rds/project/rds-Yuap0gjVpKM/jw2055/counterspeech-iib-project/counterspeech_project-NLP/generator_only/data/gab_trial.txt
2022-03-23 22:19:44,194 INFO     | Opt:
2022-03-23 22:19:44,194 INFO     |     activation: gelu
2022-03-23 22:19:44,194 INFO     |     adafactor_eps: '[1e-30, 0.001]'
2022-03-23 22:19:44,194 INFO     |     adam_eps: 1e-08
2022-03-23 22:19:44,194 INFO     |     add_p1_after_newln: False
2022-03-23 22:19:44,194 INFO     |     aggregate_micro: False
2022-03-23 22:19:44,194 INFO     |     allow_missing_init_opts: False
2022-03-23 22:19:44,195 INFO     |     attention_dropout: 0.0
2022-03-23 22:19:44,195 INFO     |     batchsize: 32
2022-03-23 22:19:44,195 INFO     |     beam_block_full_context: True
2022-03-23 22:19:44,195 INFO     |     beam_block_list_filename: None
2022-03-23 22:19:44,195 INFO     |     beam_block_ngram: -1
2022-03-23 22:19:44,195 INFO     |     beam_context_block_ngram: -1
2022-03-23 22:19:44,195 INFO     |     beam_delay: 30
2022-03-23 22:19:44,195 INFO     |     beam_length_penalty: 0.65
2022-03-23 22:19:44,195 INFO     |     beam_min_length: 1
2022-03-23 22:19:44,195 INFO     |     beam_size: 20
2022-03-23 22:19:44,195 INFO     |     betas: '[0.9, 0.999]'
2022-03-23 22:19:44,195 INFO     |     bpe_add_prefix_space: None
2022-03-23 22:19:44,195 INFO     |     bpe_debug: False
2022-03-23 22:19:44,195 INFO     |     bpe_dropout: None
2022-03-23 22:19:44,195 INFO     |     bpe_merge: /rds/project/rds-Yuap0gjVpKM/jw2055/counterspeech-iib-project/counterspeech_project-NLP/generator_only/from_pretrained_generative_conan_temperature/model.dict-merges.txt
2022-03-23 22:19:44,195 INFO     |     bpe_vocab: /rds/project/rds-Yuap0gjVpKM/jw2055/counterspeech-iib-project/counterspeech_project-NLP/generator_only/from_pretrained_generative_conan_temperature/model.dict-vocab.json
2022-03-23 22:19:44,195 INFO     |     checkpoint_activations: False
2022-03-23 22:19:44,195 INFO     |     compute_tokenized_bleu: False
2022-03-23 22:19:44,195 INFO     |     datapath: /rds/project/rds-Yuap0gjVpKM/jw2055/counterspeech-iib-project/python3.8/lib/python3.8/site-packages/data
2022-03-23 22:19:44,195 INFO     |     datatype: train
2022-03-23 22:19:44,195 INFO     |     delimiter: '  '
2022-03-23 22:19:44,195 INFO     |     dict_class: parlai.core.dict:DictionaryAgent
2022-03-23 22:19:44,195 INFO     |     dict_endtoken: __end__
2022-03-23 22:19:44,195 INFO     |     dict_file: /rds/project/rds-Yuap0gjVpKM/jw2055/counterspeech-iib-project/counterspeech_project-NLP/generator_only/from_pretrained_generative_conan_temperature/model.dict
2022-03-23 22:19:44,195 INFO     |     dict_include_test: False
2022-03-23 22:19:44,195 INFO     |     dict_include_valid: False
2022-03-23 22:19:44,195 INFO     |     dict_initpath: None
2022-03-23 22:19:44,195 INFO     |     dict_language: english
2022-03-23 22:19:44,196 INFO     |     dict_loaded: True
2022-03-23 22:19:44,196 INFO     |     dict_lower: False
2022-03-23 22:19:44,196 INFO     |     dict_max_ngram_size: -1
2022-03-23 22:19:44,196 INFO     |     dict_maxexs: -1
2022-03-23 22:19:44,196 INFO     |     dict_maxtokens: -1
2022-03-23 22:19:44,196 INFO     |     dict_minfreq: 0
2022-03-23 22:19:44,196 INFO     |     dict_nulltoken: __null__
2022-03-23 22:19:44,196 INFO     |     dict_starttoken: __start__
2022-03-23 22:19:44,196 INFO     |     dict_textfields: text,labels
2022-03-23 22:19:44,196 INFO     |     dict_tokenizer: bytelevelbpe
2022-03-23 22:19:44,196 INFO     |     dict_unktoken: __unk__
2022-03-23 22:19:44,196 INFO     |     display_add_fields: 
2022-03-23 22:19:44,196 INFO     |     display_examples: False
2022-03-23 22:19:44,196 INFO     |     download_path: None
2022-03-23 22:19:44,196 INFO     |     dropout: 0.1
2022-03-23 22:19:44,196 INFO     |     dynamic_batching: None
2022-03-23 22:19:44,196 INFO     |     embedding_projection: random
2022-03-23 22:19:44,196 INFO     |     embedding_size: 2560
2022-03-23 22:19:44,196 INFO     |     embedding_type: random
2022-03-23 22:19:44,196 INFO     |     embeddings_scale: True
2022-03-23 22:19:44,196 INFO     |     eval_batchsize: 10
2022-03-23 22:19:44,196 INFO     |     eval_dynamic_batching: None
2022-03-23 22:19:44,196 INFO     |     evaltask: None
2022-03-23 22:19:44,196 INFO     |     ffn_size: 10240
2022-03-23 22:19:44,196 INFO     |     final_extra_opt: 
2022-03-23 22:19:44,196 INFO     |     force_fp16_tokens: True
2022-03-23 22:19:44,196 INFO     |     fp16: True
2022-03-23 22:19:44,196 INFO     |     fp16_impl: safe
2022-03-23 22:19:44,196 INFO     |     fromfile_datapath: /rds/project/rds-Yuap0gjVpKM/jw2055/counterspeech-iib-project/counterspeech_project-NLP/generator_only/data/gab_trial.txt
2022-03-23 22:19:44,196 INFO     |     fromfile_datatype_extension: True
2022-03-23 22:19:44,197 INFO     |     gpu: -1
2022-03-23 22:19:44,197 INFO     |     gradient_clip: 0.1
2022-03-23 22:19:44,197 INFO     |     hide_labels: False
2022-03-23 22:19:44,197 INFO     |     history_add_global_end_token: end
2022-03-23 22:19:44,197 INFO     |     history_reversed: False
2022-03-23 22:19:44,197 INFO     |     history_size: -1
2022-03-23 22:19:44,197 INFO     |     image_cropsize: 224
2022-03-23 22:19:44,197 INFO     |     image_mode: raw
2022-03-23 22:19:44,197 INFO     |     image_size: 256
2022-03-23 22:19:44,197 INFO     |     inference: beam
2022-03-23 22:19:44,197 INFO     |     init_model: /rds/project/rds-Yuap0gjVpKM/jw2055/counterspeech-iib-project/counterspeech_project-NLP/generator_only/from_pretrained_generative/model
2022-03-23 22:19:44,197 INFO     |     init_opt: None
2022-03-23 22:19:44,197 INFO     |     interactive_mode: False
2022-03-23 22:19:44,197 INFO     |     invsqrt_lr_decay_gamma: -1
2022-03-23 22:19:44,197 INFO     |     is_debug: False
2022-03-23 22:19:44,197 INFO     |     label_truncate: 128
2022-03-23 22:19:44,197 INFO     |     learn_positional_embeddings: False
2022-03-23 22:19:44,197 INFO     |     learningrate: 7e-06
2022-03-23 22:19:44,197 INFO     |     log_every_n_secs: 10.0
2022-03-23 22:19:44,197 INFO     |     log_every_n_steps: 50
2022-03-23 22:19:44,197 INFO     |     loglevel: info
2022-03-23 22:19:44,197 INFO     |     lr_scheduler: reduceonplateau
2022-03-23 22:19:44,197 INFO     |     lr_scheduler_decay: 0.5
2022-03-23 22:19:44,197 INFO     |     lr_scheduler_patience: 3
2022-03-23 22:19:44,197 INFO     |     max_train_steps: -1
2022-03-23 22:19:44,197 INFO     |     max_train_time: 43200.0
2022-03-23 22:19:44,197 INFO     |     metrics: default
2022-03-23 22:19:44,197 INFO     |     model: transformer/generator
2022-03-23 22:19:44,197 INFO     |     model_file: /rds/project/rds-Yuap0gjVpKM/jw2055/counterspeech-iib-project/counterspeech_project-NLP/generator_only/from_pretrained_generative_conan_temperature/model
2022-03-23 22:19:44,197 INFO     |     model_parallel: True
2022-03-23 22:19:44,198 INFO     |     momentum: 0
2022-03-23 22:19:44,198 INFO     |     multitask_weights: '[1.0, 3.0, 3.0, 3.0]'
2022-03-23 22:19:44,198 INFO     |     mutators: None
2022-03-23 22:19:44,198 INFO     |     n_decoder_layers: 24
2022-03-23 22:19:44,198 INFO     |     n_encoder_layers: 2
2022-03-23 22:19:44,198 INFO     |     n_heads: 32
2022-03-23 22:19:44,198 INFO     |     n_layers: 2
2022-03-23 22:19:44,198 INFO     |     n_positions: 128
2022-03-23 22:19:44,198 INFO     |     n_segments: 0
2022-03-23 22:19:44,198 INFO     |     nesterov: True
2022-03-23 22:19:44,198 INFO     |     no_cuda: False
2022-03-23 22:19:44,198 INFO     |     num_epochs: 10.0
2022-03-23 22:19:44,198 INFO     |     num_examples: 3
2022-03-23 22:19:44,198 INFO     |     num_workers: 0
2022-03-23 22:19:44,198 INFO     |     nus: [0.7]
2022-03-23 22:19:44,198 INFO     |     optimizer: adam
2022-03-23 22:19:44,198 INFO     |     output_scaling: 1.0
2022-03-23 22:19:44,198 INFO     |     override: "{'task': 'fromfile:parlaiformat', 'fromfile_datapath': '/rds/project/rds-Yuap0gjVpKM/jw2055/counterspeech-iib-project/counterspeech_project-NLP/generator_only/data/gab_trial.txt', 'model': 'transformer/generator', 'model_file': '/rds/project/rds-Yuap0gjVpKM/jw2055/counterspeech-iib-project/counterspeech_project-NLP/generator_only/from_pretrained_generative_conan_temperature/model', 'num_examples': '3', 'skip_generation': False, 'verbose': True}"
2022-03-23 22:19:44,198 INFO     |     parlai_home: /rds/project/rds-Yuap0gjVpKM/jw2055/counterspeech-iib-project/python3.8/lib/python3.8/site-packages
2022-03-23 22:19:44,198 INFO     |     person_tokens: False
2022-03-23 22:19:44,198 INFO     |     rank_candidates: False
2022-03-23 22:19:44,198 INFO     |     relu_dropout: 0.0
2022-03-23 22:19:44,198 INFO     |     save_after_valid: True
2022-03-23 22:19:44,198 INFO     |     save_every_n_secs: -1
2022-03-23 22:19:44,198 INFO     |     share_word_embeddings: True
2022-03-23 22:19:44,198 INFO     |     short_final_eval: False
2022-03-23 22:19:44,198 INFO     |     skip_generation: False
2022-03-23 22:19:44,198 INFO     |     special_tok_lst: None
2022-03-23 22:19:44,198 INFO     |     split_lines: False
2022-03-23 22:19:44,199 INFO     |     starttime: Mar23_21-26
2022-03-23 22:19:44,199 INFO     |     task: fromfile:parlaiformat
2022-03-23 22:19:44,199 INFO     |     temperature: 4.0
2022-03-23 22:19:44,199 INFO     |     tensorboard_log: False
2022-03-23 22:19:44,199 INFO     |     tensorboard_logdir: None
2022-03-23 22:19:44,199 INFO     |     text_truncate: 128
2022-03-23 22:19:44,199 INFO     |     topk: 25
2022-03-23 22:19:44,199 INFO     |     topp: 0.9
2022-03-23 22:19:44,199 INFO     |     truncate: 128
2022-03-23 22:19:44,199 INFO     |     update_freq: 2
2022-03-23 22:19:44,199 INFO     |     use_reply: label
2022-03-23 22:19:44,199 INFO     |     validation_cutoff: 1.0
2022-03-23 22:19:44,199 INFO     |     validation_every_n_epochs: 1.0
2022-03-23 22:19:44,199 INFO     |     validation_every_n_secs: -1
2022-03-23 22:19:44,199 INFO     |     validation_every_n_steps: -1
2022-03-23 22:19:44,199 INFO     |     validation_max_exs: -1
2022-03-23 22:19:44,199 INFO     |     validation_metric: ppl
2022-03-23 22:19:44,199 INFO     |     validation_metric_mode: max
2022-03-23 22:19:44,199 INFO     |     validation_patience: 10
2022-03-23 22:19:44,199 INFO     |     validation_share_agent: False
2022-03-23 22:19:44,199 INFO     |     variant: prelayernorm
2022-03-23 22:19:44,199 INFO     |     verbose: True
2022-03-23 22:19:44,199 INFO     |     wandb_entity: None
2022-03-23 22:19:44,199 INFO     |     wandb_log: False
2022-03-23 22:19:44,199 INFO     |     wandb_name: None
2022-03-23 22:19:44,199 INFO     |     wandb_project: None
2022-03-23 22:19:44,199 INFO     |     warmup_rate: 0.0001
2022-03-23 22:19:44,199 INFO     |     warmup_updates: 100
2022-03-23 22:19:44,199 INFO     |     weight_decay: None
2022-03-23 22:19:44,306 INFO     | Current ParlAI commit: ce52624beeba71defb0b65b7c4e7f269d5e582db
2022-03-23 22:19:44,398 INFO     | Current internal commit: ce52624beeba71defb0b65b7c4e7f269d5e582db
2022-03-23 22:19:44,487 INFO     | Current fb commit: ce52624beeba71defb0b65b7c4e7f269d5e582db
[id]: data/gab_trial.txt
[text]: You crack ass cracker
[eval_labels]: Please don't that word.
   [id]: TransformerGenerator
   [beam_texts]: ('Using racial slurs doesn’t contribute to meaningful discussion', -37.302703857421875)
  ('Using racial slurs doesn’t contribute to meaningful conversation', -37.31163024902344)
  ('Using racial slurs doesn’t contribute to meaningful dialogue', -37.73188400268555)
  ('Using racial slurs doesn’t contribute to meaningful discourse', -37.79348373413086)
  ('Using racial slurs doesn’t contribute to meaningful discourse.', -38.36345291137695)
  ... (5 of 23 shown)
   [text]: Using racial slurs doesn’t contribute to meaningful discussion
   [metrics]: 
    accuracy  bleu-4  clen  ctrunc  ctrunclen  exs  f1  llen  loss  ltrunc  ltrunclen  \
           0       0     6       0          0    1   0     7 3.455       0          0   
     ppl  token_acc  token_em  
   31.67      .1429         0
   [token_losses]: ĠPlease 4.673 | Ġdon 3.234 | 't 0.009866 | Ġthat 11.09 | Ġword 2.376 | . 1.453 | __end__ 1.347 | __null__ 0.0
- - - - - - - END OF EPISODE - - - - - - - - - -
~~
[id]: data/gab_trial.txt
[text]: You dirty paki
[eval_labels]: Please don't that word.
   [id]: TransformerGenerator
   [beam_texts]: ('Use of the slur here is unacceptable in discourse as it demeans and insults Muslims.', -40.06085968017578)
  ('Use of the slur here is unacceptable in our discourse as it demeans and insults Muslims.', -40.079917907714844)
  ('Use of the slur here is unacceptable in our discourse as it demeans and insults Muslims', -40.14292907714844)
  ('Use of the slur here is unacceptable in our discourse as it demeans and insults Islam.', -40.75701904296875)
  ('Use of the slur here is unacceptable in our discourse as it demeans and insults Muslims!', -40.848453521728516)
  ... (5 of 21 shown)
   [text]: Use of the slur here is unacceptable in discourse as it demeans and insults Muslims.
   [metrics]: 
    accuracy  bleu-4  clen  ctrunc  ctrunclen  exs  f1  llen  loss  ltrunc  ltrunclen  \
           0       0     6       0          0    1   0     7 3.467       0          0   
     ppl  token_acc  token_em  
   32.04      .1429         0
   [token_losses]: ĠPlease 4.564 | Ġdon 3.04 | 't 0.00806 | Ġthat 11.1 | Ġword 2.837 | . 1.437 | __end__ 1.279 | __null__ 0.0
- - - - - - - END OF EPISODE - - - - - - - - - -
~~
[id]: data/gab_trial.txt
[text]: fuck of you yellow chink
[eval_labels]: Please don't that word.
   [id]: TransformerGenerator
   [beam_texts]: ('Use of the c-word is unacceptable in our discourse as it demeans and insults women.', -39.954586029052734)
  ('Use of the slur here is unacceptable in our discourse as it demeans and insults Muslims.', -40.060882568359375)
  ('Use of the slur here is unacceptable in our discourse as it demeans and insults Asians.', -40.27741241455078)
  ('Use of the n-word is unacceptable in our discourse as it demeans and insults blacks.', -40.294044494628906)
  ('Use of the slur here is unacceptable in our discourse as it demeans and insults Asians', -40.48371124267578)
  ... (5 of 24 shown)
   [text]: Use of the c-word is unacceptable in our discourse as it demeans and insults women.
   [metrics]: 
    accuracy    bleu-4  clen  ctrunc  ctrunclen  exs    f1  llen  loss  ltrunc  \
           0 7.433e-11     7       0          0    1 .1000     7 3.537       0   
    ltrunclen   ppl  token_acc  token_em  
            0 34.36      .1429         0
   [token_losses]: ĠPlease 4.514 | Ġdon 3.332 | 't 0.007416 | Ġthat 10.87 | Ġword 3.367 | . 1.509 | __end__ 1.157 | __null__ 0.0
- - - - - - - END OF EPISODE - - - - - - - - - -
~~
2022-03-23 22:20:15,313 INFO     | epoch done
/rds/project/rds-Yuap0gjVpKM/jw2055/counterspeech-iib-project/python3.8/lib/python3.8/site-packages/parlai/core/torch_generator_agent.py:1610: UserWarning: __floordiv__ is deprecated, and its behavior will change in a future version of pytorch. It currently rounds toward 0 (like the 'trunc' function NOT 'floor'). This results in incorrect rounding for negative values. To keep the current behavior, use torch.div(a, b, rounding_mode='trunc'), or for actual floor division, use torch.div(a, b, rounding_mode='floor').
  hyp_ids = best_idxs // voc_size
/rds/project/rds-Yuap0gjVpKM/jw2055/counterspeech-iib-project/python3.8/lib/python3.8/site-packages/parlai/core/torch_generator_agent.py:1610: UserWarning: __floordiv__ is deprecated, and its behavior will change in a future version of pytorch. It currently rounds toward 0 (like the 'trunc' function NOT 'floor'). This results in incorrect rounding for negative values. To keep the current behavior, use torch.div(a, b, rounding_mode='trunc'), or for actual floor division, use torch.div(a, b, rounding_mode='floor').
  hyp_ids = best_idxs // voc_size
/rds/project/rds-Yuap0gjVpKM/jw2055/counterspeech-iib-project/python3.8/lib/python3.8/site-packages/parlai/core/torch_generator_agent.py:1610: UserWarning: __floordiv__ is deprecated, and its behavior will change in a future version of pytorch. It currently rounds toward 0 (like the 'trunc' function NOT 'floor'). This results in incorrect rounding for negative values. To keep the current behavior, use torch.div(a, b, rounding_mode='trunc'), or for actual floor division, use torch.div(a, b, rounding_mode='floor').
  hyp_ids = best_idxs // voc_size
Changed directory to /rds/project/rds-Yuap0gjVpKM/jw2055/counterspeech-iib-project.

JobID: 57613254
======
Time: Wed 23 Mar 22:20:20 GMT 2022
Running on master node: gpu-q-55
Current directory: /rds/project/rds-Yuap0gjVpKM/jw2055/counterspeech-iib-project
/usr/bin/perl: symbol lookup error: /usr/local/software/slurm/slurm-19.05.5/lib64/perl5/auto/Slurm/Slurm.so: undefined symbol: Perl_xs_apiversion_bootcheck

Nodes allocated:
================


numtasks=1, numnodes=1, mpi_tasks_per_node=1 (OMP_NUM_THREADS=1)

Executing command:
==================
 

